<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Grafica Sniper 360</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b0c2a;
      color: white;
      text-align: center;
      padding: 20px;
    }
    input, button, select {
      margin: 10px;
      padding: 10px;
      border: none;
      border-radius: 6px;
    }
    #preview {
      width: 250px;
      height: 250px;
      margin: auto;
      border: 2px solid #444;
      background-color: #111;
      background-size: cover;
      background-position: center;
    }
  </style>
</head>
<body>

  <h1>Grafica Sniper 360</h1>

  <input type="file" id="imageInput" accept="image/*"><br>

  <div id="preview"></div><br>

  <label>Velocit√† (frame/s):</label>
  <input type="number" id="speedInput" value="20" min="1" max="100"><br>

  <button onclick="rotateImage()">üéûÔ∏è Genera GIF 360¬∞</button>
  <button onclick="downloadOriginal()">üíæ Salva Immagine</button>
  <a id="downloadLink" style="display:none;" download="360.gif">üì• Scarica GIF</a>

  <canvas id="canvas" width="250" height="250" style="display:none;"></canvas>

  <script>
    let originalImage;
    let preview = document.getElementById('preview');

    document.getElementById('imageInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          originalImage = new Image();
          originalImage.src = e.target.result;
          originalImage.onload = () => {
            preview.style.backgroundImage = `url(${originalImage.src})`;
          };
        };
        reader.readAsDataURL(file);
      }
    });

    function rotateImage() {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const speed = parseInt(document.getElementById('speedInput').value) || 20;
      const frames = 36;
      const angleStep = 360 / frames;
      const images = [];

      let angle = 0;

      for (let i = 0; i < frames; i++) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width/2, canvas.height/2);
        ctx.rotate((angle * Math.PI) / 180);
        ctx.drawImage(originalImage, -originalImage.width/4, -originalImage.height/4, originalImage.width/2, originalImage.height/2);
        ctx.restore();
        images.push(canvas.toDataURL('image/png'));
        angle += angleStep;
      }

      createGIF(images, speed);
    }

    function createGIF(images, speed) {
      const gif = new GIF({
        workers: 2,
        quality: 10,
        workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js'
      });

      images.forEach(src => {
        const img = new Image();
        img.src = src;
        gif.addFrame(img, { delay: 1000 / speed });
      });

      gif.on('finished', function(blob) {
        const url = URL.createObjectURL(blob);
        const downloadLink = document.getElementById('downloadLink');
        downloadLink.href = url;
        downloadLink.style.display = 'inline';
        downloadLink.textContent = 'üì• Scarica GIF 360';
      });

      gif.render();
    }

    function downloadOriginal() {
      if (!originalImage) return;
      const a = document.createElement('a');
      a.href = originalImage.src;
      a.download = 'immagine-originale.png';
      a.click();
    }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

</body>
</html>
